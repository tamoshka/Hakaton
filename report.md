# Отчёт о выполнении задачи "Дрон-инспектор"
## Постановка задачи
Компания создаёт дрон для мониторинга. Дрон летает на определённое расстояние, но всегда в местах, где также может присутствовать гражданская авиация. Поэтому в рамках Хакатона предлагается:
- Доработать предложенную архитектуру бортового обеспечения дрона с учётом целей безопасности
- Декомпозировать систему и отделить критический для целей безопасности код
- Необходимо внедрить в ПО "мониторинг безопасности" и реализовать контроль подсистем дрона
- Доработать функциональный прототип
- Создать автоматизированные тесты, демонстрирующие работу механизмов защиты
## Известные ограничения и вводные условия
1. По условиям организаторов должна использоваться микросервисная архитектура и шина обмена сообщениями для реализации асинхронной работы сервисов.
2. Между собой сервисы ПЛК общаются через message bus, а всё снаружи принимают в виде REST запросов.
3. Физическая надёжность аппаратуры и периметра не учитываются.
4. Графический интерфейс для взаимодействия с пользователем не требуется, достаточно примеров REST запросов.
5. Персонал, обслуживающий систему - благонадёжен
### Цели и преположения безопасности (ЦПБ)
Цели безопасности:
1. Выполняются только аутентичные задания на мониторинг
2. Выполняются только авторизованные системой ОрВД задания
3. Все манёвры совершаются согласно ограничениям в полётном задании (высота, полётная зона)
4. Только авторизованные пользователи имеют доступ к сохранённым данным фото-видео фиксации
5. В случае критического отказа дрон снижается со скоростью не более 1м/с
6. Для запроса авторизации вылета к системе ОрВД используется только аутентичный идентификатор дрона
7. Только авторизованные получатели имеют доступ к оперативной информации

Предположения безопасности:
1. Аутентичная система ОрВД благонадёжна
2. Аутентичные сотрудники благонадёжны и обладают необходимой квалификацией
3. Только авторизованные сотрудники управляют системами
4. Аутентичное полётное задание составлено так, что на всём маршруте дрон может совершить аварийную посадку без причинения неприемлимого ущерба заказчику и третьим лицам

## Архитектура решения

### Описание системы
Изначально система выглядела следующим образом:

<img width="510" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/b847953f-1139-43dd-80b9-edba16027f33">


В ходе решения она была детализирована до следующей:

<img width="468" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/5bdf10cf-a2d6-475e-834a-7000fa737dc5">

[Ссылка на Google Диск](https://drive.google.com/file/d/1asFjLODZ_IIuXuLfq-LM8nW5l2W1fPx0/view?usp=drive_link)

### Компоненты и назначение

| Название | Назначение | Комментарий |
| ----------- | ----------- | ----------- |
| 1. First Veriefer | Иммитатор модуля, производящего проверку на то, что сигнал действительно дошёл до БПЛА, а также проверяющий, от авторизованного пользователя пришёл сигнал или нет | Неоверенный, т.к. сигнал к модулям отправляется в незашифрованном виде, что нарушает пункт 7 ЦБ|
| 2. Manager | Иммитатор системы, являющийся основным передатчиком/перенаправлятором системы между другими модулями | Недоверенный, т.к. нарушает пункт 7 ЦБ |
| 3. ATM | Внешняя система, осуществляющая контроль над передвижением воздушных транспортов, сверяющая маршруты и дающая право/запрет на перемещение | Повышающий доверие, не нарушает приципов ЦБ, канал зашумлён, но данные ему приходящие нарушали принципы ЦБ |
| 4. Входные данные | Иммитатор, перенаправляющий входные данные на другие модули, позволяющий снизить нагрузку с Manager | Недоверенный, т.к. не шифрует входные данные в следствии чего нарушает 7 пункт ЦБ |
| 5. Выходные данные | Иммитатор, отправляющий пакет зашифрованных данных Manager, для дальнейшего отправления получателю | Доверенный, не нарушает приципов ЦБ, данные приходят зашифрованными |
| 6. Хранилище | Иммитатор системы, хранящей фото-видео материалы, записанные фото-видео фиксатором | Доверенный, не нарушает приципов ЦБ, данные приходят зашифрованными |
| 7. Шифратор | Иммитатор системы, шифрующий входящий в него поток данные, что позволяет запретить доступ к ним после прохождения данного этапа | Повышающий доверие, не нарушает приципов ЦБ, шифрует входящие данные и отправляет их в зашифрованном формате |
| 8. Фото-видео фиксатор | Иммитатор системы, производящий фото-видео съёмку в соответствии с целью задания | Недоверенный, т.к. нарушает пункты 4 и 7 ЦБ |
| 9. Система передвижения дрона, перерасчёт скорости и положения | Иммитатор системы, принимающий запрос на передвижение в пространстве и регулирующий его при помощи вычислений между отправленными данными и полученными текущими координатами | Недоверенный, т.к. нарушает пункт 7 ЦБ |
| 10. Система проверки координат | Иммитатор системы, принимающий запрос на сверку координат, после обращающийся к внешним системам и перенаправляющий информацию системе передвижения | Повышающий доверие, поскольку нарушает пунт 7 ЦБ |
| 11. Система Глонасс | Внешняя система, позволяющая отслеживать координаты дрона | Повышающий доверие, не нарушает приципов ЦБ, канал зашумлён, но данные ему приходящие нарушали принципы ЦБ |
| 12. Двигатель | Иммитатор двигателя БПЛА, предаставляющего возможность физического перемещения дрона | Недоверенный, т.к. в случае поломки самостоятельно не принимает решение о снижении скорости, а также может нарушить поведение в воздушном пространстве, чем нарушает ЦБ 3,5 |


### Алгоритм работы решения

Диаграма последовательности:

<img width="795" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/4742aeca-ca92-4099-8fb9-e0376cacbce3">

[Ссылка на Google Диск](https://drive.google.com/file/d/1eJpvQ0umgiPxwbYr_6bKypPpxOMaT3-q/view?usp=drive_link)

### Описание сценариев, при которых ЦБ может нарушаться

Архитектура построена по принципу отказа максимум одного из условных компонентов. В случае отказа более 1 элемента, система явно даст сбой. Подобная проектировка обоснована задачами поставленными в ЦБ и задачей минимазации доверенного кода.

Наиболее вероятные версии сценариев атаки на систему:

| Название | Атакованный модуль | Нарушенная ЦБ | Комментарий |
| ----------- | ----------- | ----------- | ----------- |
| 1. DOS-атака на модуль First Veriefer | First Veriefer | 1, 2, 4, 7 | Отказ в обслуживание, но т.к. доступа к управлению не происходит - ЦБ не нарушается |
| 2. Подмена входных данных | First Veriefer | 1, 2, 3, 4 | Защитой является метод зашумления входного сигнала, ЦБ нарушить не удастся |
| 3. Бездействие модулей | Любой модуль | Все | Попыткой борьбы с этим может являться создание системы модулей с обратными сигналами, сообщающими об успешной передачи сообщения и заданными тааймингами на модулях, ожидающих данный сигнал |
| 4. Взлом First Veriefer | First Veriefer | 1, 2, 3, 4, 7 | Т.к. First Veriefer принимает исходящие сигналы, может произойти ситуация, в которой его попытаются взломать злоумышлиники. Проверкой служит идентификация и аутентификация входящего запроса |
| 5. Подмена данных отправляемых Manager или Системы проверки координат от Глонасс и ATM | Manager, Система проверки координат | 1, 2, 3, 4, 5, 7 | Аналогично с о2 вариантом атаки |
| 6. Подмена выходных данных | Manager, Оператор системы планирования | 1, 2, 3, 4, 5, 6, 7 | Аналогично с 4 вариантом атаки |
| 7. Повтор команд в следствии отсутствия подтверждения прихода данных между модулями | Любой модуль | Все | Необходимо хранить информацию о последней пришедшей команде, сравнивать, и в случае отличий Id выполнять, в случае совпадения, отбрасывать и посылать сигнал о выполнении |
| 8. Ошибка при передачи внутренних данных | Любой модуль | Все | Необходимо сделать механизм схожий с TCP протоколами, чтобы подтверждать верность переданных данных |

Негативный сценарий 1 Dos-атака на модуль First Veriefer

<img width="345" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/629fa51a-7599-4ede-9045-7aade3f5f8c8">

Негативный сценарий 2 Подмена входных данных

<img width="237" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/06b8b57f-eefc-40c5-b81f-277b7f94c766">

Негативный сценарий 3 Бездействие модулей

<img width="243" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/bd47b231-f722-4e37-adae-6ac805f530ca">

Негативный сценарий 4 Взлом First Veriefer

<img width="298" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/193c3997-8802-4d21-b843-48d18b4f306d">

Негативный сценарий 5 Подмена данных отправляемых Manager или Системы проверки координат от Глонасс и ATM

<img width="248" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/5e84eb35-4e96-42df-a75b-3a1ac91f7ea2">

Негативный сценарий 6 Подмена выходных данных

<img width="260" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/5cc0a548-0eef-47cd-b6d0-42fbdd9b8ffc">

Негативный сценарий 7 Повтор команд в следствии отсутствия подтверждения прихода данных между модулями

<img width="281" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/2f751570-66c9-4fb9-9ca3-5d6eb631bef7">

Негативный сценарий 8 Ошибка при передачи внутренних данных 

<img width="243" alt="image" src="https://github.com/tamoshka/Hakaton/assets/127463024/f355c2ce-a751-4794-81c1-50725021fe86">
